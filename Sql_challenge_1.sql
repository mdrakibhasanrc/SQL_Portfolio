-- Matthew steel SQL challenge 1

CREATE TABLE car (
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);
--------------------
INSERT INTO car (car_id, make, type, style, cost_$)
VALUES (1, 'Honda', 'Civic', 'Sedan', 30000),
(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
(3, 'Ford', 'Explorer', 'SUV', 40000),
(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
(5, 'BMW', 'X5', 'SUV', 55000),
(6, 'Audi', 'A4', 'Sedan', 48000),
(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
(8, 'Nissan', 'Altima', 'Sedan', 26000);



CREATE TABLE salespersons (
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)
);
--------------------
INSERT INTO salespersons (salesman_id, name, age, city)
VALUES (1, 'John Smith', 28, 'New York'),
(2, 'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee', 42, 'Seattle'),
(4, 'Lucy Chen', 31, 'LA');

CREATE TABLE sales (
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES car(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);
--------------------
INSERT INTO sales (sale_id, car_id, salesman_id, purchase_date)
VALUES (1, 1, 1, '2021-01-01'),
(2, 3, 3, '2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01');







--Q1: What are the details of all cars purchased in the year 2022?
select 
   *
 from car c
 left join sales s on c.car_id=s.car_id
 where extract(year from purchase_date)=2022;

-- Q2. What is the total number of cars sold by each salesperson?
select 
   s.name,
   count(o.sale_id) as total_number
 from salespersons s
 inner join sales o on s.salesman_id=o.salesman_id
 group by s.name;
   
-- Q3. What is the total revenue generated by each salesperson?

select 
   s.name,
   sum(c.cost_$) as total_revenue
 from salespersons s
 inner join sales od on s.salesman_id=od.salesman_id
 inner join car c on c.car_id=od.car_id
 group by s.name
 order by total_revenue desc;


-- Q4. What is the total revenue generated by each car type?
select
   c.type,
   sum(c.cost_$) as total_revenue
 from car c
 inner join sales s on s.car_id=c.car_id
 group by c.type
 order by total_revenue desc;
 
 
 -- Q5. What are the details of the cars sold in the year 2021 by salesperson ‘Emily Wong’?
select
   sa.name,
   c.make,
   c.type,
   c.style,
   c.cost_$,
   s.purchase_date
from salespersons sa
inner join sales s on s.salesman_id=sa.salesman_id
inner join car c on c.car_id=s.car_id
where sa.name='Emily Wong' and extract(year from purchase_date)=2021;

-- Q6:  What is the total revenue generated by the sales of hatchback cars?
select
   style, 
   sum(cost_$) as "revenue generated by the sales of hatchback cars"
from car
join sales using(car_id)
where style='Hatchback'
group by style;

-- Q7. What is the total revenue generated by the sales of SUV cars in the year 2022?
select
   style, 
   sum(cost_$) as "revenue generated by the sales of hatchback cars"
from car
join sales using(car_id)
where style='SUV' and extract(year from purchase_date)=2021
group by style;


-- Q8. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
select
    sa.name,
	sa.city,
	count(s.car_id) as total_sold
from salespersons sa
inner join sales s on s.salesman_id=sa.salesman_id
where extract(year from purchase_date)=2023
group by sa.name,sa.city
order by total_sold desc
limit 1;

-- Q9. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
select
    sa.name,
	sa.age,
	count(s.car_id) as total_Sold,
	sum(c.cost_$) as total_revenue
from salespersons sa
inner join sales s on s.salesman_id=s.salesman_id
inner join car c on c.car_id=s.car_id
where extract(year from purchase_date)=2022
group by sa.name,sa.age
order by total_revenue desc
limit 1;


